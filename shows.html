<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ===== Metadata and External Resources ===== -->
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Find your next favorite TV show on Snug Hub. Browse and filter by genre, language, and country to discover what to watch next."/>
  <meta name="keywords" content="TV shows, comfort shows, stream TV, shows by genre, shows by country, shows by language, Snug Hub, TV series guide"/>
  <title>Browse TV Shows by Genre, Language & Country | Snug Hub</title>
  <!-- Bootstrap CSS -->
   <link href="./node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
  <!-- Font Awesome Icon -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- Custom Styles -->
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
 <header>
  <!-- ===== Navigation Bar ===== -->
  <nav class="navbar navbar-expand-lg custom-navbar navbar-dark">
    <div class="container-fluid">
      <!-- Logo and Brand -->
      <a class="navbar-brand" href="index.html">
        <img src="images/snug-logo.png" alt="Snug Hub Logo" width="60" height="60" style="margin-right: 0px;"> Snug Hub</a>
      <!-- Navbar Toggler (for mobile) -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <!-- Navbar Links -->
      <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
        <ul class="navbar-nav mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="shows.html">Shows</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="people.html">People</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="schedule.html">Schedule</a>
          </li>
        </ul>
      </div>
<!-- Search Form -->
<form id="globalSearchForm"
      class="d-flex flex-grow-1 flex-md-grow-0 align-items-center position-relative search-form"
      role="search" autocomplete="off" style="max-width: 100%;">
  
  <input id="globalSearchInput"
         class="form-control me-2 search-input"
         type="search"
         placeholder="Search people or shows..."
         aria-label="Search"
         style="min-width: 0; flex: 1;" />
  
  <button class="btn custom-search-btn" type="submit">Search</button>

  <!-- Live search dropdown -->
  <div id="searchDropdown"
       class="list-group position-absolute w-100"
       style="top: 100%; z-index: 1000; display: none;"></div>
</form>
  </nav>
  <!-- ===== End of Navigation Bar ===== -->
 </header>


    <!-- ===== Main Content ===== -->
  <main>
  <div class="container py-4">
    <!-- Page Title -->
        <h1 id="heading" class="text-center">Shows</h1>
        <h2 id="subheading" class="text-center">Love drama? Crave comedy? Browse and find your next binge watch!</h2>
    <!-- Search + Filters + Sort Row -->
    <div class="row g-2 mb-4 align-items-center">
      <!-- Search Bar -->
<div class="col-md-3 position-relative">
  <i class="fa-solid fa-magnifying-glass position-absolute search-icon"></i>
  <input type="text" id="searchShows" class="form-control form-control-sm ps-4" placeholder="Search shows...">
</div>
      <!-- Genre Filter -->
      <div class="col-md-2">
        <select id="filterGenre" class="form-select form-select-sm">
          <option value="">All Genres</option>
        </select>
      </div>
      <!-- Language Filter -->
      <div class="col-md-2">
        <select id="filterLanguage" class="form-select form-select-sm">
          <option value="">All Languages</option>
        </select>
      </div>
      <!-- Country Filter -->
      <div class="col-md-2">
        <select id="filterCountry" class="form-select form-select-sm">
          <option value="">All Countries</option>
        </select>
      </div>
      <!-- Type Filter -->
      <div class="col-md-2">
        <select id="filterType" class="form-select form-select-sm">
          <option value="">All Types</option>
        </select>
      </div>
      <!-- Sort Dropdown -->
      <div class="col-md-1">
        <select id="sortBy" class="form-select form-select-sm">
          <option value="">Sort</option>
          <option value="popularity">Popular</option>
          <option value="az">A - Z</option>
          <option value="za">Z - A</option>
          <option value="recent">Recent</option>
        </select>
      </div>
    </div>

    <!-- Show Grid -->
    <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-6 g-2" id="shows"></div>

    <!-- Pagination Controls -->
    <div id="pagination" class="mt-4 text-center"></div>
  </div>
</main>
  <!-- ===== End of Main Content ===== -->

  <!-- ===== Footer ===== -->
  <footer class="footer pt-5 pb-4 mt-5 border-top w-100">
    <div class="container-fluid px-4">
      <div class="row">
        <!-- About Section -->
        <div class="col-md-6 mb-4">
          <h3>About Snug Hub</h3>
          <h4 class="small">
            Snug Hub helps you find your favourite comfort TV shows and where to watch them.
          </h4>
        </div>
        <!-- Quick Links -->
        <div class="col-md-6 mb-4">
          <h3>Quick Links</h3>
          <ul class="list-unstyled">
            <li><a href="index.html" class="hover-link">Home</a></li>
            <li><a href="shows.html" class="hover-link">Shows</a></li>
            <li><a href="people.html" class="hover-link">People</a></li>
            <li><a href="schedule.html" class="hover-link">Schedule</a></li>
          </ul>
        </div>
      </div>
      
      <div class="text-center small mt-3 pb-2">
        Â© 2025 Snug Hub.
      </div>
    </div>
  </footer>
  <!-- ===== End of Footer ===== -->

  <!-- ===== JavaScript Page Logic ===== -->
  <script>
// Fetch popular shows and render them in a live dropdown
document.addEventListener('DOMContentLoaded', () => {
  const input = document.getElementById('globalSearchInput');
  const dropdown = document.getElementById('searchDropdown');
  let debounceTimer;

  input.addEventListener('input', () => {
    const query = input.value.trim();

    clearTimeout(debounceTimer);
    if (!query) {
      dropdown.style.display = 'none';
      return;
    }

    debounceTimer = setTimeout(() => {
      performLiveSearch(query);
    }, 300); // debounce
  });

  // Hide dropdown when clicking outside
  document.addEventListener('click', (e) => {
    if (!dropdown.contains(e.target) && e.target !== input) {
      dropdown.style.display = 'none';
    }
  });

  function performLiveSearch(query) {
    dropdown.innerHTML = '<div class="list-group-item">Searching...</div>';
    dropdown.style.display = 'block';

    const showSearch = fetch(`https://api.tvmaze.com/search/shows?q=${query}`).then(res => res.json());
    const peopleSearch = fetch(`https://api.tvmaze.com/search/people?q=${query}`).then(res => res.json());

    Promise.all([showSearch, peopleSearch])
      .then(([shows, people]) => {
        dropdown.innerHTML = '';

        if (!shows.length && !people.length) {
          dropdown.innerHTML = '<div class="list-group-item text-muted">No results found</div>';
          return;
        }

        shows.slice(0, 5).forEach(item => {
          const s = item.show;
          const el = document.createElement('div');
          el.className = 'list-group-item';
          el.innerHTML = `<strong>Show:</strong> ${s.name}`;
          el.addEventListener('click', () => {
            window.location.href = `show-info.html?id=${s.id}`;
          });
          dropdown.appendChild(el);
        });

        people.slice(0, 5).forEach(item => {
          const p = item.person;
          const el = document.createElement('div');
          el.className = 'list-group-item';
          el.innerHTML = `<strong>Person:</strong> ${p.name}`;
          el.addEventListener('click', () => {
            window.location.href = `person-info.html?id=${p.id}`;
          });
          dropdown.appendChild(el);
        });
      })
      .catch(err => {
        console.error(err);
        dropdown.innerHTML = '<div class="list-group-item text-danger">Error fetching results</div>';
      });
  }
});


// Main logic for fetching and displaying shows
document.addEventListener('DOMContentLoaded', () => {
  // Get references to DOM elements
  const showsContainer = document.getElementById('shows');
  const paginationContainer = document.getElementById('pagination');
  const searchInput = document.getElementById('searchShows');
  const filterGenre = document.getElementById('filterGenre');
  const filterLanguage = document.getElementById('filterLanguage');
  const filterCountry = document.getElementById('filterCountry');
  const filterType = document.getElementById('filterType');
  const sortBy = document.getElementById('sortBy');
  
    // Show "no results found" if there are no shows to display with the chosen filters
  const observer = new MutationObserver(() => {
    const showCards = showsContainer.querySelectorAll('.col');
    let noResults = document.getElementById('noResultsMsg');
    if (showCards.length === 0) {
      if (!noResults) {
        noResults = document.createElement('div');
        noResults.id = 'noResultsMsg';
        noResults.className = 'w-100 text-center py-4';
        noResults.textContent = 'No results found';
        showsContainer.appendChild(noResults);
      }
    } else if (noResults) {
      noResults.remove();
    }
  });
  observer.observe(showsContainer, { childList: true });
  
  // Number of shows to display per page
  const SHOWS_PER_PAGE = 18;
  let allShows = []; 
  let currentPage = 0; 

  // Fetch shows from TVMaze 
  async function fetchShows() {
    let page = 0;
    let results = [];
    let nextPage = true;
    while (nextPage && page < 10) {
      const res = await fetch(`https://api.tvmaze.com/shows?page=${page}`);
      const data = await res.json();
      if (data.length === 0) nextPage = false;
      results = results.concat(data);
      page++;
    }
    allShows = results;
    populateFilters(); // Populate filter dropdowns
    renderShows();     // Render the initial list of shows
  }

  // Populate filter dropdowns with unique values from allShows
  function populateFilters() {
    const genres = new Set();
    const languages = new Set();
    const countries = new Set();
    const types = new Set();

    allShows.forEach(show => {
      show.genres.forEach(g => genres.add(g));
      if (show.language) languages.add(show.language);
      if (show.network?.country?.name) countries.add(show.network.country.name);
      if (show.type) types.add(show.type);
    });

    // Add options to each filter dropdown
    filterGenre.innerHTML += [...genres].sort().map(g => `<option value="${g}">${g}</option>`).join('');
    filterLanguage.innerHTML += [...languages].sort().map(l => `<option value="${l}">${l}</option>`).join('');
    filterCountry.innerHTML += [...countries].sort().map(c => `<option value="${c}">${c}</option>`).join('');
    filterType.innerHTML += [...types].sort().map(t => `<option value="${t}">${t}</option>`).join('');
  }

  // Render the shows based on filters, search, sorting, and pagination
  function renderShows() {
    showsContainer.innerHTML = '';

    // Filter shows based on user input and selected filters
    let filtered = allShows.filter(show => {
      return (
        (!searchInput.value || show.name.toLowerCase().includes(searchInput.value.toLowerCase())) &&
        (!filterGenre.value || show.genres.includes(filterGenre.value)) &&
        (!filterLanguage.value || show.language === filterLanguage.value) &&
        (!filterCountry.value || show.network?.country?.name === filterCountry.value) &&
        (!filterType.value || show.type === filterType.value)
      );
    });

    // Sort the filtered shows based on selected sort option
    switch (sortBy.value) {
      case 'az':
        filtered.sort((a, b) => a.name.localeCompare(b.name));
        break;
      case 'za':
        filtered.sort((a, b) => b.name.localeCompare(a.name));
        break;
      case 'recent':
        filtered.sort((a, b) => new Date(b.updated) - new Date(a.updated));
        break;
      case 'popularity':
        filtered.sort((a, b) => (b.weight || 0) - (a.weight || 0));
        break;
    }

  
    const totalPages = Math.ceil(filtered.length / SHOWS_PER_PAGE);
    const start = currentPage * SHOWS_PER_PAGE;
    const end = start + SHOWS_PER_PAGE;
    const pageShows = filtered.slice(start, end);

    // Render each show as a card
    pageShows.forEach(show => {
      const div = document.createElement('div');
      div.className = 'col text-center';
      div.innerHTML = `
        <a href="show-info.html?id=${show.id}" class="text-decoration-none">
          <img src="${show.image?.medium}" class="card-img-square mb-2 alt="${show.name}">
          <div class="show-title"><strong>${show.name}</strong></div>
        </a>
      `;
      showsContainer.appendChild(div);
    });

    // Render pagination controls
    renderPagination(filtered.length, totalPages);
  }

  // Render pagination controls
  function renderPagination(totalItems, totalPages) {
    paginationContainer.innerHTML = '';
    const nav = document.createElement('nav');
    const ul = document.createElement('ul');
    ul.className = 'pagination justify-content-center flex-wrap';

    const maxVisiblePages = 5; // Max number of page buttons to show at once
    const startPage = Math.floor(currentPage / maxVisiblePages) * maxVisiblePages;
    const endPage = Math.min(startPage + maxVisiblePages, totalPages);

    // Add previous button if not on the first set of pages
    if (startPage > 0) {
      const li = document.createElement('li');
      li.className = 'page-item';
      li.innerHTML = '<button class="page-link">&laquo;</button>';
      li.addEventListener('click', () => {
        currentPage = startPage - 1;
        renderShows();
      });
      ul.appendChild(li);
    }

    // Add page number buttons
    for (let i = startPage; i < endPage; i++) {
      const li = document.createElement('li');
      li.className = 'page-item' + (i === currentPage ? ' active' : '');

      const btn = document.createElement('button');
      btn.className = 'page-link';
      btn.textContent = i + 1;
      btn.addEventListener('click', () => {
        currentPage = i;
        renderShows();
      });

      li.appendChild(btn);
      ul.appendChild(li);
    }

    // Add "next" button if there are more pages
    if (endPage < totalPages) {
      const li = document.createElement('li');
      li.className = 'page-item';
      li.innerHTML = '<button class="page-link">&raquo;</button>';
      li.addEventListener('click', () => {
        currentPage = endPage;
        renderShows();
      });
      ul.appendChild(li);
    }

    nav.appendChild(ul);
    paginationContainer.appendChild(nav);
  }

  // Add event listeners to all filter and sort controls
  [searchInput, filterGenre, filterLanguage, filterCountry, filterType, sortBy].forEach(el => {
    el.addEventListener('input', () => {
      currentPage = 0;
      renderShows();
    });
    el.addEventListener('change', () => {
      currentPage = 0;
      renderShows();
    });
  });

  // Initial fetch of shows when the page loads
  fetchShows();
});
 
  </script>
  <!-- ===== End of JavaScript Page Logic ===== -->

  <!-- Scripts -->
  <script src="./node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="script.js"></script>
</body>
</html>
